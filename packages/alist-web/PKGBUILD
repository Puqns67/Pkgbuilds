# Maintainer: Puqns67 <me@puqns67.icu>

_organization_url='https://github.com/alist-org'
_solid_router_git_hash='f77b206e8592bb56d2d001e9488de5a54a13699b'

pkgname='alist-web'
pkgver=3.31.0
pkgrel=1
pkgdesc='A file list/WebDAV program that supports multiple storages, powered by Gin and Solidjs.'
url="${_organization_url}/${pkgname}"
license=('AGPL-3.0-or-later')
arch=('any')
makedepends=('pnpm')

source=("${pkgname}-${pkgver}.tar.gz"::"${url}/archive/refs/tags/${pkgver}.tar.gz"
        "solid_router-${_solid_router_git_hash}.tar.gz"::"${_organization_url}/solid-router/archive/${_solid_router_git_hash}.tar.gz")

b2sums=('f1deb1182dde1e741ced916a3e45c1f7b5c0f3d0033195ddc7da9c400a3bf83dc399645c211111e2b1f1ddcf155f43e4e725dcb108c7a6c8aec0f709ad935869'
        '0678eafed0908109fda831cbdeccb676e212960bdec0ad062064415566c8f11076bf3a706a1719b21d238dccbaa96e47cb5d265f4d7e5f21f2bd4f5a1e1296f9')

prepare() {
  # Move solid-router to sources.
  rm -rfv "${srcdir}/${pkgname}-${pkgver}/solid-router"
  mv -v "${srcdir}/solid-router-${_solid_router_git_hash}" "${srcdir}/${pkgname}-${pkgver}/solid-router"

  # Update version with $pkgver.
  sed -ie "s/0.0.0/${pkgver}/g" "${srcdir}/${pkgname}-${pkgver}/package.json"

  # Install dependencies
  cd "${srcdir}/${pkgname}-${pkgver}"
  HUSKY=0 pnpm install
}

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  pnpm build
}

package() {
  install -dm755 "${pkgdir}/usr/share"
  cp -rv "${srcdir}/${pkgname}-${pkgver}/dist" "${pkgdir}/usr/share/${pkgname}"
}
